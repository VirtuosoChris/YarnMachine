# YarnMachine
(WIP) Standalone C++ virtual machine for Yarn Spinner.

Yarn Spinner is a neat scripting language for branching narrative that is similar to INK and is intuitive because it kind of just resembles a linear screenplay.

https://yarnspinner.dev/

This project is meant to be a standalone (non Unity, engine agnostic) C++ virtual machine that interprets the compiled Yarn script files.

The Github project for the original Yarn Spinner (which I'm entirely unaffiliated with) can be found here:
https://github.com/YarnSpinnerTool/YarnSpinner

and an online sandbox to try the language can be found at:
https://try.yarnspinner.dev/

and the Visual Studio Code plugin (which is my preferred means of authoring scripts) can be found at :
https://marketplace.visualstudio.com/items?itemName=SecretLab.yarn-spinner

This project doesn't interpret .yarn scripts directly; it depends on 3 input files generated by the Yarn Compiler toolchain.  So you'll either need to provide these files with your game or ship the yarn compiler with your game.

1) compiled .yarnc binary files.
The compiled .yarnc files are generated as Google Protobufs
https://developers.google.com/protocol-buffers/docs/reference/cpp-generated

So protobuf is a dependency and protoc is used to generate parsing code from the original yarn_spinner.proto file that defines the Yarn Spinner bytecode format.

2 / 3) the two generated csv files containing the line database, and the metadata.
I am using the following C++ CSV parser as an additional dependency:

https://github.com/vincentlaucsb/csv-parser


Additional Notes, differences from "real" Yarn Spinner:

- Since this is C++ / engine agnostic, GUI is bring-your-own.
- This logically includes all markup parsing, eg. as described here:
https://docs.yarnspinner.dev/getting-started/writing-in-yarn/markup
- character attribute, select, plurals, and ordinals as described on that same page feel more like a language feature / syntactic sugar but they aren't compiled to anything special in the .yarnc and are treated like any other markup.  This can be seen in how they don't seem to be supported in the current Try Yarnspinner sandbox or the VS code plugin.  I plan to add a "helper" / convenience function for processing these specific markups and add them to the "demo" dialog player.
- Tracking headers as described here: https://docs.yarnspinner.dev/getting-started/writing-in-yarn/tags-metadata are ignored and node visited counts are always computed.
- Built in operators and functions have been tested and implemented and should all work.
- Commands and functions are implemented as std::function callbacks stored in a lookup table
- The sample command binding functionality is supplied via VirtuosoConsole's QuakeStyleConsole.h 
https://github.com/VirtuosoChris/VirtuosoConsole
which can take an arbitrary c++ function and do template magic to generate type correct iostream parsers without writing any code yourself.  But you can do whatever you want with commands, like pass them to a scripting language or whatever else you want.
- Tutorials and easy dependency fetching / building to come :)
